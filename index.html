<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Koch App</title>

<!-- PWA -->
<link rel="manifest" href="manifest.json">

<style>
body{
  margin:0;
  font-family:Arial;
  background:#fff8e1;
  text-align:center;
}

.screen{display:none;padding:40px;}
.active{display:block;}

button{
  padding:12px 20px;
  margin:10px;
  background:orange;
  border:none;
  border-radius:10px;
  color:white;
  cursor:pointer;
}

#topBar{
  position:fixed;
  top:10px;
  right:10px;
  display:flex;
  gap:10px;
  align-items:center;
}

#statusDot{
  width:15px;
  height:15px;
  border-radius:50%;
  background:red;
}
</style>
</head>

<body>

<!-- START -->
<div id="startScreen" class="screen active">
<h1>ğŸ³ Koch App</h1>

<button onclick="connectMicrobit()">micro:bit suchen</button><br>
<button onclick="goToRecipes()">Ãœberspringen</button>

<p id="statusText">Nicht verbunden</p>
</div>

<!-- REZEPTE -->
<div id="recipeScreen" class="screen">

<div id="topBar">
<div id="statusDot"></div>
<button onclick="connectMicrobit()">Neu verbinden</button>
</div>

<h1>ğŸ“– Rezepte</h1>

<button>ğŸ• Pizza</button>
<button>ğŸ¥£ Suppe</button>
<button>ğŸ° Kuchen</button>

<br><br>

<button id="installBtn" style="display:none;">
ğŸ“² App herunterladen
</button>

</div>

<script>

/* ---------- MICROBIT ---------- */
let device = null;

function goToRecipes(){
  document.getElementById("startScreen").classList.remove("active");
  document.getElementById("recipeScreen").classList.add("active");
  updateStatus();
}

function updateStatus(){
  const dot = document.getElementById("statusDot");
  dot.style.background = device ? "green" : "red";
}

async function connectMicrobit(){
  try{
    device = await navigator.bluetooth.requestDevice({
      filters:[{namePrefix:"BBC micro:bit"}],
      optionalServices:['e95d93af-251d-470a-a062-fa1922dfa9a8']
    });

    document.getElementById("statusText").innerText =
      "Verbunden mit: " + device.name;

    goToRecipes();

  }catch(e){
    console.log(e);
  }

  updateStatus();
}

/* ---------- APP INSTALL ---------- */
let deferredPrompt;

window.addEventListener("beforeinstallprompt",(e)=>{
  e.preventDefault();
  deferredPrompt = e;
  document.getElementById("installBtn").style.display="inline-block";
});

installBtn.addEventListener("click", async ()=>{
  if(deferredPrompt){
    deferredPrompt.prompt();
    await deferredPrompt.userChoice;
    deferredPrompt=null;
  }
});

/* ---------- SERVICE WORKER ---------- */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("service-worker.js");
}

</script>

</body>
</html>
